> Project Framework & Height Map

## Summary
This week I worked mainly on system framework and height map. Generally, my terrain system's main features are creating height map and generating 
terrain mesh by a height map. Now I can read a `.raw` height map file and handle its data, but cannot render a mesh yet. 
Consider that we may have different mesh formats, I decided to build a independent terrain format so that everyone can use it.

## Framework
I create three projects that have different functions, `Terrain`, `TerrainBuilder`, and `HeightMaoGenerator`. Each of them is independent. 

* Terrain

    Liturally, Terrain is just a mesh, so I implemented it just like `cMesh` class. Terrain knows nothing about height map, it just read binary files generated by `TerrainBuilder`. I noticed I want to make terrain by voxels and I still want to do that. But before that, I just read terrain meshes and render them.

* TerrainBuilder

    This project's main function is to read height map, create a mesh based on the height map, and export mesh data into output folder. It doesn't know how height map generated and how output binary files will be used. 

* HeightMapGenerator

    This project will build a `.exe` file for users to generate height maps. In my mind, it interface will be like terrain system in Unity, users can paint on a plane to make a terrain. Essentially, they are painting a grey bit image. They can also choose to press one key to generate a random map by perlin noise. Then, they can save their artwork into game resource folder.


## HeightMap
Height map is the core of this system. By grey bit information, a image can express a 3D mesh data. The depth values of pixels are height values of vertices.

![](/img/in-post/write-up-11/1.png)

#### Raw File Format
Generally, height map is in 8-bit `raw` format, which is a binary image file that only has one channel. It contains every pixels gray depth value, its size is the size of a `BYTE`. It doesn't have a file header. We can read it directly.

#### Generate Height Map
Now I use Unity to paint a terrain and export raw file, which is very convenient. In the next two weeks, I will implement generatingf height map function, automaticlly, manually, or both. 

![](/img/in-post/write-up-11/2.JPG)

#### Generate Terrain Mesh
To generally a mesh by height map is easy. Every pixel will be a vertex and its z value will be its grey value. The distance between two neighbor vertex decide how large the terrain will be, which can be set by users.
![](/img/in-post/write-up-11/3.png)